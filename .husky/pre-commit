#!/usr/bin/env sh
set -e

# Check for staged files
if [ -z "$(git diff --cached --name-only)" ]; then
    echo "No staged files found. Skipping pre-commit hooks."
    exit 0
fi

# Run frontend linters
cd frontend
if [ -f "package.json" ]; then
    if grep -q "lint-staged" package.json; then
        echo "Running lint-staged..."
        npx --no-install lint-staged || {
            echo "❌ lint-staged failed"
            exit 1
        }
    fi
fi
cd ..

# Run pre-commit hooks if available
if command -v pre-commit >/dev/null 2>&1; then
    echo "Running pre-commit hooks..."
    pre-commit run --files $(git diff --cached --name-only)
fi
